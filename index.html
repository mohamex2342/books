<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖŸÉÿ™ÿ®ÿ™Ÿä ÿßŸÑÿ±ŸÇŸÖŸäÿ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.37);
            --shadow-heavy: 0 15px 35px rgba(31, 38, 135, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Enhanced Navbar */
        .navbar {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: 2px;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .logo:hover::after {
            transform: scaleX(1);
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-icon {
            font-size: 1.8rem;
            color: #667eea;
            cursor: pointer;
            padding: 1rem;
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .search-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .search-icon:hover::before {
            width: 100px;
            height: 100px;
        }

        .search-icon:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* User Authentication UI */
        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .auth-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 20px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .login-btn {
            background: var(--primary-gradient);
            color: white;
        }

        .register-btn {
            background: var(--success-gradient);
            color: white;
        }

        .logout-btn {
            background: var(--danger-gradient);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Authentication Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 3rem;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 90%;
            max-width: 450px;
            animation: modalSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.8) translateY(50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-title {
            font-size: 2rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            color: #666;
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1rem;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .form-submit {
            width: 100%;
            padding: 1.2rem;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .form-switch {
            text-align: center;
            color: #666;
        }

        .form-switch button {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            text-decoration: underline;
        }

        .close-auth {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--danger-gradient);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .close-auth:hover {
            transform: scale(1.1) rotate(90deg);
        }

        /* Book Rating System */
        .book-rating {
            margin: 1rem 0;
            text-align: center;
        }

        .stars-container {
            margin: 0.5rem 0;
        }

        .star {
            font-size: 1.8rem;
            color: #ddd;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 0.1rem;
        }

        .star.filled {
            color: #ffd700;
        }

        .star:hover {
            transform: scale(1.2);
            color: #ffd700;
        }

        .rating-info {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 0.5rem;
        }

        .rating-average {
            font-weight: 600;
            color: #ffd700;
        }

        /* Protected Actions */
        .protected-action {
            position: relative;
        }

        .protected-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            color: white;
            font-size: 0.9rem;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .protected-action:hover .protected-overlay {
            opacity: 1;
        }

        /* Enhanced Search Container */
        .search-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 1rem;
            transform: translateY(-150%) scale(0.8);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .search-container.active {
            transform: translateY(0) scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .search-wrapper {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-bar {
            width: 100%;
            padding: 1.5rem 4rem 1.5rem 2rem;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            font-family: 'Cairo', sans-serif;
            font-weight: 500;
            outline: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            border-color: #667eea;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            transform: scale(1.02);
        }

        .search-clear {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--danger-gradient);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: none;
            transition: all 0.3s ease;
        }

        .search-clear:hover {
            transform: translateY(-50%) scale(1.1);
        }

        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 3rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-top: 3rem;
        }

        /* Enhanced Book Card */
        .book-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: var(--shadow-light);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
            border-radius: 25px 25px 0 0;
        }

        .book-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .book-card:hover {
            transform: translateY(-15px) rotateX(5deg);
            box-shadow: 0 25px 50px rgba(31, 38, 135, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .book-card:hover::after {
            opacity: 1;
        }

        .book-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
            animation: bookFloat 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }

        @keyframes bookFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        .book-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            line-height: 1.6;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .book-actions {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        /* Enhanced Action Buttons */
        .action-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 20px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.5s ease;
            transform: translate(-50%, -50%);
        }

        .action-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .read-btn {
            background: var(--primary-gradient);
            color: white;
        }

        .read-btn:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .download-btn {
            background: var(--success-gradient);
            color: white;
        }

        .download-btn:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 15px 30px rgba(17, 153, 142, 0.4);
        }

        .download-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .share-btn {
            background: var(--danger-gradient);
            color: white;
        }

        .share-btn:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 15px 30px rgba(255, 65, 108, 0.4);
        }

        /* Enhanced Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: modalFadeIn 0.5s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            width: 90%;
            height: 90%;
            border-radius: 30px;
            position: relative;
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            animation: modalSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 1rem;
            border-radius: 50%;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg) scale(1.1);
        }

        .pdf-viewer {
            width: 100%;
            height: calc(100% - 120px);
            border: none;
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 4rem;
            color: white;
            font-size: 1.3rem;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No Results State */
        .no-results {
            grid-column: 1/-1;
            text-align: center;
            color: white;
            font-size: 1.5rem;
            padding: 4rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
            opacity: 0.7;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 100px;
            right: 2rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 4000;
            transform: translateX(400px);
            transition: transform 0.4s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #38ef7d;
        }

        .notification.error {
            border-left: 4px solid #ff4b2b;
        }

        .notification.warning {
            border-left: 4px solid #f093fb;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .navbar-content {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .logo {
                font-size: 1.8rem;
            }

            .user-section {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .auth-btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }

            .container {
                padding: 2rem 1rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .books-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .book-actions {
                flex-direction: column;
                gap: 1rem;
            }

            .modal-content {
                width: 95%;
                height: 95%;
                border-radius: 20px;
            }

            .modal-header {
                padding: 1.5rem;
            }

            .book-card {
                padding: 2rem;
            }

            .auth-form {
                padding: 2rem;
                margin: 1rem;
            }

            .notification {
                right: 1rem;
                left: 1rem;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.6rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .book-title {
                font-size: 1.3rem;
            }

            .search-bar {
                font-size: 1rem;
                padding: 1.2rem 3.5rem 1.2rem 1.5rem;
            }
        }

        /* Scroll animations */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .book-card {
            animation: slideUp 0.6s ease forwards;
        }

        .book-card:nth-child(1) { animation-delay: 0.1s; }
        .book-card:nth-child(2) { animation-delay: 0.2s; }
        .book-card:nth-child(3) { animation-delay: 0.3s; }
        .book-card:nth-child(4) { animation-delay: 0.4s; }
        .book-card:nth-child(5) { animation-delay: 0.5s; }
        .book-card:nth-child(6) { animation-delay: 0.6s; }
        .book-card:nth-child(7) { animation-delay: 0.7s; }
        .book-card:nth-child(8) { animation-delay: 0.8s; }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Enhanced Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="#" class="logo">üìö ŸÖŸÉÿ™ÿ®ÿ™Ÿä ÿßŸÑÿ±ŸÇŸÖŸäÿ©</a>
            <div class="navbar-actions">
                <div class="search-icon" onclick="toggleSearch()">üîç</div>
                <div class="user-section" id="userSection">
                    <!-- User auth buttons will be inserted here -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-form">
            <button class="close-auth" onclick="closeAuthModal()">‚úñ</button>
            <div class="auth-header">
                <h2 class="auth-title" id="authTitle">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</h2>
                <p class="auth-subtitle" id="authSubtitle">ÿßÿØÿÆŸÑ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ŸÖŸÉÿ™ÿ®ÿ™ŸÉ</p>
            </div>
            <form id="authForm">
                <div class="form-group" id="nameGroup" style="display: none;">
                    <label class="form-label">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ</label>
                    <input type="text" class="form-input" id="fullName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ÿßŸÑŸÉÿßŸÖŸÑ">
                </div>
                <div class="form-group">
                    <label class="form-label">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                    <input type="email" class="form-input" id="email" placeholder="ÿ£ÿØÿÆŸÑ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                    <input type="password" class="form-input" id="password" placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" required>
                </div>
                <div class="form-group" id="confirmPasswordGroup" style="display: none;">
                    <label class="form-label">ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="ÿ£ŸÉÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±">
                </div>
                <button type="submit" class="form-submit" id="authSubmitBtn">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
                <div class="form-switch">
                    <span id="switchText">ŸÑÿß ÿ™ŸÖŸÑŸÉ ÿ≠ÿ≥ÿßÿ®ÿü</span>
                    <button type="button" id="switchBtn" onclick="switchAuthMode()">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Enhanced Search Container -->
    <div class="search-container" id="searchContainer">
        <div class="search-wrapper">
            <input type="text" class="search-bar" id="searchBar" placeholder="ÿßÿ®ÿ≠ÿ´ ŸÅŸä ŸÖŸÉÿ™ÿ®ÿ™ŸÉ ÿßŸÑÿ±ŸÇŸÖŸäÿ©..." onkeyup="searchBooks()" oninput="toggleClearButton()">
            <button class="search-clear" id="searchClear" onclick="clearSearch()">‚úñ</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <h2 class="section-title">‚ú® ŸÖÿ¨ŸÖŸàÿπÿ™Ÿä ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ŸÖŸÜ ÿßŸÑŸÉÿ™ÿ®</h2>
        <div class="books-grid" id="booksGrid">
            <!-- Books will be dynamically loaded here -->
        </div>
    </div>

    <!-- Enhanced Modal -->
    <div class="modal" id="pdfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">ÿπÿßÿ±ÿ∂ ÿßŸÑŸÉÿ™ÿßÿ®</h3>
                <button class="close-btn" onclick="closeModal()">‚úñ</button>
            </div>
            <iframe class="pdf-viewer" id="pdfViewer" src=""></iframe>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Dynamic PDF Books Display with Debugging -->
    <script>
    document.addEventListener('DOMContentLoaded', function(){
        const pdfFiles = [
            'book1.pdf',
            'book2.pdf',
            'book3.pdf',
            'book4.pdf',
            'book5.pdf',
            'book6.pdf',
            'book7.pdf'
        ];
        const booksGrid = document.getElementById('booksGrid');

        if (!booksGrid) {
            console.error('Element with ID "booksGrid" not found.');
            return;
        }

        pdfFiles.forEach(file => {
            const filePath = `books/${file}`;
            const card = document.createElement('div');
            card.className = 'book-card';
            card.innerHTML = `
                <div class="book-icon">üìò</div>
                <div class="book-title">${file}</div>
                <div class="book-actions">
                    <a class="read-btn action-btn" href="${filePath}" target="_blank">ÿßŸÇÿ±ÿ£</a>
                    <a class="download-btn action-btn" href="${filePath}" download>ÿ™ÿ≠ŸÖŸäŸÑ</a>
                    <button class="share-btn action-btn" onclick="shareBook('${file}', '${filePath}')">ŸÖÿ¥ÿßÿ±ŸÉÿ©</button>
                </div>
            `;
            booksGrid.appendChild(card);
        });

        console.log('PDF files loaded successfully:', pdfFiles);
    });
    </script>

    <script>
        // Firebase Configuration (Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ Ÿáÿ∞Ÿá ÿßŸÑŸÇŸäŸÖ ÿ®ŸÇŸäŸÖ ŸÖÿ¥ÿ±ŸàÿπŸÉ ÿßŸÑŸÅÿπŸÑŸä)
        const firebaseConfig = {
            apiKey: "AIzaSyCPmffrAJIm3GELYowytRc50FiB317HWfY",
    authDomain: "chat-m-r.firebaseapp.com",
    databaseURL: "https://chat-m-r-default-rtdb.firebaseio.com",
    projectId: "chat-m-r",
    storageBucket: "chat-m-r.firebasestorage.app",
    messagingSenderId: "950103914840",
    appId: "1:950103914840:android:13171827163f19808acd2d"
  };

        // Initialize Firebase
        let auth, db;
        
        // Simulate Firebase initialization for demo purposes
        // ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿå Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Firebase SDK ÿßŸÑÿ≠ŸÇŸäŸÇŸä
        if (typeof firebase !== 'undefined') {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        } else {
            // Demo mode - simulate Firebase
            auth = {
                currentUser: null,
                onAuthStateChanged: (callback) => {
                    // Simulate user state from localStorage
                    const user = JSON.parse(localStorage.getItem('demoUser') || 'null');
                    setTimeout(() => callback(user), 100);
                },
                signInWithEmailAndPassword: (email, password) => {
                    return new Promise((resolve, reject) => {
                        // Demo login validation
                        const users = JSON.parse(localStorage.getItem('demoUsers') || '[]');
                        const user = users.find(u => u.email === email && u.password === password);
                        
                        if (user) {
                            const authUser = {
                                uid: user.id,
                                email: user.email,
                                displayName: user.name
                            };
                            localStorage.setItem('demoUser', JSON.stringify(authUser));
                            auth.currentUser = authUser;
                            resolve({ user: authUser });
                        } else {
                            reject(new Error('ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©'));
                        }
                    });
                },
                createUserWithEmailAndPassword: (email, password) => {
                    return new Promise((resolve, reject) => {
                        const users = JSON.parse(localStorage.getItem('demoUsers') || '[]');
                        
                        if (users.find(u => u.email === email)) {
                            reject(new Error('ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ'));
                            return;
                        }
                        
                        const newUser = {
                            id: Date.now().toString(),
                            email,
                            password,
                            name: document.getElementById('fullName').value
                        };
                        
                        users.push(newUser);
                        localStorage.setItem('demoUsers', JSON.stringify(users));
                        
                        const authUser = {
                            uid: newUser.id,
                            email: newUser.email,
                            displayName: newUser.name
                        };
                        
                        localStorage.setItem('demoUser', JSON.stringify(authUser));
                        auth.currentUser = authUser;
                        resolve({ user: authUser });
                    });
                },
                signOut: () => {
                    return new Promise((resolve) => {
                        localStorage.removeItem('demoUser');
                        auth.currentUser = null;
                        resolve();
                    });
                }
            };
            
            db = {
                collection: (name) => ({
                    doc: (id) => ({
                        set: (data) => {
                            const key = `demo_${name}_${id}`;
                            localStorage.setItem(key, JSON.stringify(data));
                            return Promise.resolve();
                        },
                        get: () => {
                            const key = `demo_${name}_${id}`;
                            const data = localStorage.getItem(key);
                            return Promise.resolve({
                                exists: !!data,
                                data: () => data ? JSON.parse(data) : null
                            });
                        },
                        update: (data) => {
                            const key = `demo_${name}_${id}`;
                            const existing = JSON.parse(localStorage.getItem(key) || '{}');
                            localStorage.setItem(key, JSON.stringify({...existing, ...data}));
                            return Promise.resolve();
                        }
                    })
                })
            };
        }

        // Enhanced books data with ratings
        const books = [
            {
                id: 1,
                title: "ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ© ŸÑŸÑŸÖÿ®ÿ™ÿØÿ¶ŸäŸÜ",
                icon: "üìò",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿ™ŸÇŸÜŸäÿ©",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 2,
                title: "ÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿ∞ÿßÿ™ ŸàÿßŸÑŸÜÿ¨ÿßÿ≠",
                icon: "üìó",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿ™ŸÜŸÖŸäÿ© ÿ®ÿ¥ÿ±Ÿäÿ©",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 3,
                title: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸä ÿßŸÑÿπÿ±ŸäŸÇ",
                icon: "üìô",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿ™ÿßÿ±ŸäÿÆ",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 4,
                title: "ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸàÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ",
                icon: "üìï",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿ™ŸÇŸÜŸäÿ©",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 5,
                title: "ÿ±Ÿàÿßÿ¶ÿπ ÿßŸÑÿ£ÿØÿ® ÿßŸÑÿπÿ±ÿ®Ÿä",
                icon: "üìí",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿ£ÿØÿ®",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 6,
                title: "ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©",
                icon: "üìì",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿπŸÑŸàŸÖ",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 7,
                title: "ŸÅŸÜ ÿßŸÑÿ∑ÿ®ÿÆ ÿßŸÑÿπÿ±ÿ®Ÿä",
                icon: "üìî",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿ∑ÿ®ÿÆ",
                averageRating: 0,
                totalRatings: 0
            },
            {
                id: 8,
                title: "ÿπŸÑŸÖ ÿßŸÑŸÜŸÅÿ≥ ÿßŸÑÿ≠ÿØŸäÿ´",
                icon: "üìñ",
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                category: "ÿπŸÑŸàŸÖ",
                averageRating: 0,
                totalRatings: 0
            }
        ];

        let filteredBooks = [...books];
        let isLoginMode = true;
        let currentUser = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeAuth();
            loadBookRatings();
            displayBooks(books);
            createParticles();
            setupEventListeners();
        });

        // Authentication State Management
        function initializeAuth() {
            auth.onAuthStateChanged((user) => {
                currentUser = user;
                updateUserInterface();
                if (user) {
                    showNotification('ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ' + user.displayName || user.email, 'success');
                }
            });
        }

        function updateUserInterface() {
            const userSection = document.getElementById('userSection');
            
            if (currentUser) {
                userSection.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${currentUser.displayName ? currentUser.displayName[0].toUpperCase() : 'üë§'}</div>
                        <span>${currentUser.displayName || currentUser.email}</span>
                    </div>
                    <button class="auth-btn logout-btn" onclick="logout()">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
                `;
            } else {
                userSection.innerHTML = `
                    <button class="auth-btn login-btn" onclick="showAuthModal('login')">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
                    <button class="auth-btn register-btn" onclick="showAuthModal('register')">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
                `;
            }
            
            // Re-render books to update protected actions
            displayBooks(filteredBooks);
        }

        // Authentication Modal Functions
        function showAuthModal(mode) {
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authTitle');
            const subtitle = document.getElementById('authSubtitle');
            const nameGroup = document.getElementById('nameGroup');
            const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
            const submitBtn = document.getElementById('authSubmitBtn');
            const switchText = document.getElementById('switchText');
            const switchBtn = document.getElementById('switchBtn');
            
            isLoginMode = mode === 'login';
            
            if (isLoginMode) {
                title.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
                subtitle.textContent = 'ÿßÿØÿÆŸÑ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ŸÖŸÉÿ™ÿ®ÿ™ŸÉ';
                nameGroup.style.display = 'none';
                confirmPasswordGroup.style.display = 'none';
                submitBtn.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
                switchText.textContent = 'ŸÑÿß ÿ™ŸÖŸÑŸÉ ÿ≠ÿ≥ÿßÿ®ÿü';
                switchBtn.textContent = 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ';
            } else {
                title.textContent = 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ';
                subtitle.textContent = 'ÿ£ŸÜÿ¥ÿ¶ ÿ≠ÿ≥ÿßÿ®ÿßŸã ÿ¨ÿØŸäÿØÿßŸã ŸÑŸÑÿßŸÜÿ∂ŸÖÿßŸÖ ÿ•ŸÑŸâ ŸÖŸÉÿ™ÿ®ÿ™ŸÜÿß';
                nameGroup.style.display = 'block';
                confirmPasswordGroup.style.display = 'block';
                submitBtn.textContent = 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®';
                switchText.textContent = 'ÿ™ŸÖŸÑŸÉ ÿ≠ÿ≥ÿßÿ® ÿ®ÿßŸÑŸÅÿπŸÑÿü';
                switchBtn.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAuthModal() {
            const modal = document.getElementById('authModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Reset form
            document.getElementById('authForm').reset();
        }

        function switchAuthMode() {
            showAuthModal(isLoginMode ? 'register' : 'login');
        }

        // Authentication Functions
        async function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const submitBtn = document.getElementById('authSubmitBtn');
            
            // Validation
            if (!email || !password) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©', 'error');
                return;
            }
            
            if (!isLoginMode) {
                const fullName = document.getElementById('fullName').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (!fullName) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showNotification('ŸÉŸÑŸÖÿ™ÿß ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ™ÿßŸÜ', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showNotification('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ', 'error');
                    return;
                }
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ...';
            
            try {
                if (isLoginMode) {
                    await auth.signInWithEmailAndPassword(email, password);
                    showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                    showNotification('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
                }
                
                closeAuthModal();
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = isLoginMode ? 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ' : 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®';
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            } catch (error) {
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', 'error');
            }
        }

        // Rating System
        async function rateBook(bookId, rating) {
            if (!currentUser) {
                showNotification('Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã ŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÉÿ™ÿ®', 'warning');
                return;
            }
            
            try {
                // Save user's rating
                await db.collection('ratings').doc(`${currentUser.uid}_${bookId}`).set({
                    userId: currentUser.uid,
                    bookId: bookId,
                    rating: rating,
                    timestamp: new Date()
                });
                
                // Update book average rating
                await updateBookRating(bookId);
                
                showNotification('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ™ŸÇŸäŸäŸÖŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
                displayBooks(filteredBooks);
            } catch (error) {
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇŸäŸäŸÖ', 'error');
            }
        }

        async function updateBookRating(bookId) {
            // In a real app, this would calculate the average from all ratings
            // For demo purposes, we'll simulate it
            const book = books.find(b => b.id === bookId);
            if (book) {
                const ratingsKey = `ratings_${bookId}`;
                let ratings = JSON.parse(localStorage.getItem(ratingsKey) || '[]');
                
                const userRating = ratings.find(r => r.userId === currentUser.uid);
                if (userRating) {
                    userRating.rating = rating;
                } else {
                    ratings.push({ userId: currentUser.uid, rating: rating });
                }
                
                localStorage.setItem(ratingsKey, JSON.stringify(ratings));
                
                // Calculate average
                const totalRating = ratings.reduce((sum, r) => sum + r.rating, 0);
                book.averageRating = totalRating / ratings.length;
                book.totalRatings = ratings.length;
            }
        }

        async function getUserRating(bookId) {
            if (!currentUser) return 0;
            
            try {
                const doc = await db.collection('ratings').doc(`${currentUser.uid}_${bookId}`).get();
                return doc.exists ? doc.data().rating : 0;
            } catch (error) {
                return 0;
            }
        }

        async function loadBookRatings() {
            // Load ratings from localStorage for demo
            books.forEach(book => {
                const ratingsKey = `ratings_${book.id}`;
                const ratings = JSON.parse(localStorage.getItem(ratingsKey) || '[]');
                
                if (ratings.length > 0) {
                    const totalRating = ratings.reduce((sum, r) => sum + r.rating, 0);
                    book.averageRating = totalRating / ratings.length;
                    book.totalRatings = ratings.length;
                }
            });
        }

        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 2;
                const left = Math.random() * 100;
                const animationDuration = Math.random() * 10 + 15;
                const delay = Math.random() * 20;

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${left}%`;
                particle.style.animationDuration = `${animationDuration}s`;
                particle.style.animationDelay = `${delay}s`;

                particlesContainer.appendChild(particle);
            }
        }

        // Enhanced search toggle
        function toggleSearch() {
            const searchContainer = document.getElementById('searchContainer');
            const searchBar = document.getElementById('searchBar');
            
            searchContainer.classList.toggle('active');
            
            if (searchContainer.classList.contains('active')) {
                setTimeout(() => searchBar.focus(), 600);
            } else {
                clearSearch();
            }
        }

        // Clear search function
        function clearSearch() {
            const searchBar = document.getElementById('searchBar');
            const searchClear = document.getElementById('searchClear');
            
            searchBar.value = '';
            searchClear.style.display = 'none';
            searchBooks();
        }

        // Toggle clear button visibility
        function toggleClearButton() {
            const searchBar = document.getElementById('searchBar');
            const searchClear = document.getElementById('searchClear');
            
            if (searchBar.value.trim() !== '') {
                searchClear.style.display = 'block';
            } else {
                searchClear.style.display = 'none';
            }
        }

        // Enhanced search functionality
        function searchBooks() {
            const searchTerm = document.getElementById('searchBar').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                filteredBooks = [...books];
            } else {
                filteredBooks = books.filter(book => 
                    book.title.toLowerCase().includes(searchTerm) ||
                    book.category.toLowerCase().includes(searchTerm)
                );
            }
            
            displayBooks(filteredBooks);
        }

        // Enhanced display books function
        function displayBooks(booksToShow) {
            const booksGrid = document.getElementById('booksGrid');
            
            if (booksToShow.length === 0) {
                booksGrid.innerHTML = `
                    <div class="no-results">
                        <span class="no-results-icon">üîç</span>
                        <div>ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÉÿ™ÿ® ÿ™ÿ∑ÿßÿ®ŸÇ ÿ®ÿ≠ÿ´ŸÉ</div>
                        <div style="font-size: 1rem; margin-top: 1rem; opacity: 0.8;">ÿ¨ÿ±ÿ® ŸÖÿµÿ∑ŸÑÿ≠ÿßÿ™ ÿ®ÿ≠ÿ´ ÿ£ÿÆÿ±Ÿâ</div>
                    </div>
                `;
                return;
            }

            booksGrid.innerHTML = booksToShow.map((book, index) => {
                const isLoggedIn = !!currentUser;
                const downloadClass = isLoggedIn ? '' : 'protected-action';
                const downloadDisabled = isLoggedIn ? '' : 'disabled';
                
                return `
                    <div class="book-card" style="animation-delay: ${index * 0.1}s">
                        <span class="book-icon">${book.icon}</span>
                        <h3 class="book-title">${book.title}</h3>
                        
                        <!-- Book Rating Display -->
                        <div class="book-rating">
                            <div class="stars-container" id="stars-${book.id}">
                                ${generateStars(book.id, book.averageRating, isLoggedIn)}
                            </div>
                            <div class="rating-info">
                                <span class="rating-average">${book.averageRating.toFixed(1)}</span>
                                (${book.totalRatings} ÿ™ŸÇŸäŸäŸÖ)
                            </div>
                        </div>
                        
                        <div class="book-actions">
                            <button class="action-btn read-btn" onclick="readBook('${book.title}', '${book.pdfUrl}')">
                                üìñ ŸÇÿ±ÿßÿ°ÿ©
                            </button>
                            <div class="${downloadClass}">
                                <a href="${book.pdfUrl}" download class="action-btn download-btn" ${downloadDisabled ? 'onclick="return false;"' : ''}>
                                    ‚¨áÔ∏è ÿ™ÿ≠ŸÖŸäŸÑ
                                </a>
                                ${!isLoggedIn ? '<div class="protected-overlay">Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ</div>' : ''}
                            </div>
                            <button class="action-btn share-btn" onclick="shareBook('${book.title}', '${book.pdfUrl}')">
                                üì§ ŸÖÿ¥ÿßÿ±ŸÉÿ©
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateStars(bookId, averageRating, isLoggedIn) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                const filled = i <= Math.round(averageRating) ? 'filled' : '';
                const clickable = isLoggedIn ? `onclick="rateBook(${bookId}, ${i})"` : '';
                const title = isLoggedIn ? `ŸÇŸäŸÖ ÿ®ŸÄ ${i} ŸÜÿ¨ŸàŸÖ` : 'Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑÿ™ŸÇŸäŸäŸÖ';
                
                starsHtml += `<span class="star ${filled}" ${clickable} title="${title}">‚òÖ</span>`;
            }
            return starsHtml;
        }

        // Enhanced read book function
        function readBook(title, pdfUrl) {
            const modal = document.getElementById('pdfModal');
            const modalTitle = document.getElementById('modalTitle');
            const pdfViewer = document.getElementById('pdfViewer');
            
            modalTitle.innerHTML = `üìñ ŸÇÿ±ÿßÿ°ÿ©: ${title}`;
            pdfViewer.src = pdfUrl;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Enhanced close modal
        function closeModal() {
            const modal = document.getElementById('pdfModal');
            const pdfViewer = document.getElementById('pdfViewer');
            
            modal.classList.remove('active');
            setTimeout(() => {
                pdfViewer.src = '';
            }, 300);
            document.body.style.overflow = 'auto';
        }

        // Enhanced share function
        function shareBook(title, pdfUrl) {
            const subject = encodeURIComponent(`üìö ŸÖÿ¥ÿßÿ±ŸÉÿ© ŸÉÿ™ÿßÿ®: ${title}`);
            const body = encodeURIComponent(`
ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ Ÿàÿ±ÿ≠ŸÖÿ© ÿßŸÑŸÑŸá Ÿàÿ®ÿ±ŸÉÿßÿ™Ÿá

ÿ£ÿ±ÿØÿ™ ŸÖÿ¥ÿßÿ±ŸÉÿ© Ÿáÿ∞ÿß ÿßŸÑŸÉÿ™ÿßÿ® ÿßŸÑÿ±ÿßÿ¶ÿπ ŸÖÿπŸÉ ŸÖŸÜ ŸÖŸÉÿ™ÿ®ÿ™Ÿä ÿßŸÑÿ±ŸÇŸÖŸäÿ©:

üìñ ${title}

ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿßÿ∑ŸÑÿßÿπ ÿπŸÑŸäŸá Ÿàÿ™ÿ≠ŸÖŸäŸÑŸá ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ™ÿßŸÑŸä:
${pdfUrl}

ÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®ÿßŸÑŸÇÿ±ÿßÿ°ÿ©! üìö‚ú®

ŸÖÿπ ÿ™ÿ≠Ÿäÿßÿ™ ŸÖŸÉÿ™ÿ®ÿ™Ÿä ÿßŸÑÿ±ŸÇŸÖŸäÿ©
            `.trim());
            
            window.open(`mailto:?subject=${subject}&body=${body}`);
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${getNotificationIcon(type)}</span>
                    <span>${message}</span>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Hide and remove notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => container.removeChild(notification), 400);
            }, 4000);
        }

        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return '‚úÖ';
                case 'error': return '‚ùå';
                case 'warning': return '‚ö†Ô∏è';
                default: return '‚ÑπÔ∏è';
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Auth form submission
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            
            // Enhanced keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Escape key
                if (e.key === 'Escape') {
                    const searchContainer = document.getElementById('searchContainer');
                    const modal = document.getElementById('pdfModal');
                    const authModal = document.getElementById('authModal');
                    
                    if (authModal.classList.contains('active')) {
                        closeAuthModal();
                    } else if (modal.classList.contains('active')) {
                        closeModal();
                    } else if (searchContainer.classList.contains('active')) {
                        toggleSearch();
                    }
                }
                
                // Ctrl + K for search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    const searchContainer = document.getElementById('searchContainer');
                    if (!searchContainer.classList.contains('active')) {
                        toggleSearch();
                    }
                }
            });

            // Close modals when clicking outside
            document.getElementById('pdfModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            document.getElementById('authModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAuthModal();
                }
            });
        }

        // Performance optimization: Debounced search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Replace immediate search with debounced version
        const debouncedSearch = debounce(searchBooks, 300);
        
        // Update search bar event listener
        setTimeout(() => {
            const searchBar = document.getElementById('searchBar');
            if (searchBar) {
                searchBar.removeEventListener('keyup', searchBooks);
                searchBar.addEventListener('keyup', debouncedSearch);
            }
        }, 100);

        // Add ripple effect to buttons
        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
            circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
            circle.classList.add('ripple');

            const ripple = button.getElementsByClassName('ripple')[0];
            if (ripple) {
                ripple.remove();
            }

            button.appendChild(circle);
        }

        // Add ripple styles
        const rippleStyles = `
            .ripple {
                position: absolute;
                border-radius: 50%;
                background-color: rgba(255, 255, 255, 0.3);
                transform: scale(0);
                animation: ripple-animation 0.6s linear;
                pointer-events: none;
                z-index: 1000;
            }

            @keyframes ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;

        const style = document.createElement('style');
        style.textContent = rippleStyles;
        document.head.appendChild(style);

        // Apply ripple effect to all buttons (with delay to ensure DOM is ready)
        setTimeout(() => {
            const buttons = document.querySelectorAll('.action-btn, .auth-btn, .form-submit');
            buttons.forEach(button => {
                button.addEventListener('click', createRipple);
            });
        }, 1000);

        // Enhanced scroll effects
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe book cards when they're added
        function observeBookCards() {
            const bookCards = document.querySelectorAll('.book-card');
            bookCards.forEach(card => {
                observer.observe(card);
            });
        }

        // Initialize scroll observation after a delay
        setTimeout(observeBookCards, 1500);

        // Enhanced loading state
        function showLoading() {
            const booksGrid = document.getElementById('booksGrid');
            booksGrid.innerHTML = `
                <div class="loading" style="grid-column: 1/-1;">
                    <div class="spinner"></div>
                    <div>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿ™ÿ®...</div>
                </div>
            `;
        }

        // Add smooth scrolling for any anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Auto-save user preferences
        function saveUserPreferences() {
            if (currentUser) {
                const preferences = {
                    userId: currentUser.uid,
                    lastVisit: new Date(),
                    searchHistory: JSON.parse(localStorage.getItem('searchHistory') || '[]')
                };
                localStorage.setItem('userPreferences', JSON.stringify(preferences));
            }
        }

        // Save search history
        function addToSearchHistory(term) {
            if (term.trim() && currentUser) {
                let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                history = history.filter(item => item !== term);
                history.unshift(term);
                history = history.slice(0, 10); // Keep only last 10 searches
                localStorage.setItem('searchHistory', JSON.stringify(history));
            }
        }

        // Enhanced search with history
        function searchBooksWithHistory() {
            const searchTerm = document.getElementById('searchBar').value.toLowerCase().trim();
            
            if (searchTerm) {
                addToSearchHistory(searchTerm);
            }
            
            searchBooks();
        }

        // Update the search function to use history
        setTimeout(() => {
            const searchBar = document.getElementById('searchBar');
            if (searchBar) {
                searchBar.removeEventListener('keyup', debouncedSearch);
                searchBar.addEventListener('keyup', debounce(searchBooksWithHistory, 300));
            }
        }, 200);

        // Form validation helpers
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function validatePassword(password) {
            return password.length >= 6;
        }

        // Enhanced form validation
        function validateAuthForm() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!validateEmail(email)) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿµÿ≠Ÿäÿ≠', 'error');
                return false;
            }
            
            if (!validatePassword(password)) {
                showNotification('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ', 'error');
                return false;
            }
            
            return true;
        }

        // Update the handleAuth function to use validation
        const originalHandleAuth = handleAuth;
        handleAuth = function(e) {
            e.preventDefault();
            
            if (!validateAuthForm()) {
                return;
            }
            
            originalHandleAuth(e);
        };

        // Add keyboard navigation for stars
        function addStarKeyboardNavigation() {
            document.addEventListener('keydown', function(e) {
                if (e.target.classList.contains('star')) {
                    const stars = Array.from(e.target.parentElement.children);
                    const currentIndex = stars.indexOf(e.target);
                    let newIndex = currentIndex;
                    
                    if (e.key === 'ArrowRight' && currentIndex > 0) {
                        newIndex = currentIndex - 1; // Right arrow goes to previous star (RTL)
                    } else if (e.key === 'ArrowLeft' && currentIndex < stars.length - 1) {
                        newIndex = currentIndex + 1; // Left arrow goes to next star (RTL)
                    } else if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        e.target.click();
                        return;
                    }
                    
                    if (newIndex !== currentIndex) {
                        e.preventDefault();
                        stars[newIndex].focus();
                    }
                }
            });
        }

        // Initialize keyboard navigation
        setTimeout(addStarKeyboardNavigation, 500);

        // Add accessibility improvements
        function enhanceAccessibility() {
            // Add ARIA labels
            const searchIcon = document.querySelector('.search-icon');
            if (searchIcon) {
                searchIcon.setAttribute('aria-label', 'ŸÅÿ™ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´');
                searchIcon.setAttribute('role', 'button');
                searchIcon.setAttribute('tabindex', '0');
            }
            
            // Make stars focusable
            setTimeout(() => {
                const stars = document.querySelectorAll('.star');
                stars.forEach((star, index) => {
                    star.setAttribute('tabindex', '0');
                    star.setAttribute('role', 'button');
                    star.setAttribute('aria-label', `ÿ™ŸÇŸäŸäŸÖ ÿ®ŸÄ ${index + 1} ŸÜÿ¨ŸàŸÖ`);
                });
            }, 1000);
        }

        // Initialize accessibility improvements
        setTimeout(enhanceAccessibility, 800);

        // Add periodic auto-save for user session
        setInterval(() => {
            if (currentUser) {
                saveUserPreferences();
            }
        }, 30000); // Save every 30 seconds

        // Show welcome message for new users
        function showWelcomeMessage() {
            const isFirstVisit = !localStorage.getItem('hasVisited');
            
            if (isFirstVisit) {
                setTimeout(() => {
                    showNotification('üéâ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÉÿ™ÿ®ÿ™Ÿä ÿßŸÑÿ±ŸÇŸÖŸäÿ©! ÿ≥ÿ¨ŸÑ ÿØÿÆŸàŸÑŸÉ ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿ™ÿ® Ÿàÿ™ŸÇŸäŸäŸÖŸáÿß', 'success');
                    localStorage.setItem('hasVisited', 'true');
                }, 2000);
            }
        }

        // Initialize welcome message
        showWelcomeMessage();

        // Add error handling for network requests
        window.addEventListener('error', function(e) {
            if (e.message.includes('network') || e.message.includes('fetch')) {
                showNotification('ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑŸÉ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'error');
            }
        });

        // Add offline/online detection
        window.addEventListener('online', function() {
            showNotification('ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'success');
        });

        window.addEventListener('offline', function() {
            showNotification('ŸÑÿß ŸäŸàÿ¨ÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'warning');
        });

        console.log('üéâ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ÿ®ÿ™Ÿä ÿßŸÑÿ±ŸÇŸÖŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
        console.log('üìö ÿßŸÑŸÖŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©:');
        console.log('   - ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ Ÿàÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®');
        console.log('   - ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÉÿ™ÿ® (ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖÿ≥ÿ¨ŸÑŸäŸÜ)');
        console.log('   - ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿ™ÿ® (ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖÿ≥ÿ¨ŸÑŸäŸÜ)');
        console.log('   - ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ');
        console.log('   - Ÿàÿßÿ¨Ÿáÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿπÿµÿ±Ÿäÿ© ŸàŸÖÿ™ÿ¨ÿßŸàÿ®ÿ©');
    </script>
</body>
</html>
